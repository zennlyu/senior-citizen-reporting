{"ast":null,"code":"import { __assign, __extends } from \"tslib\";\nimport React, { PureComponent } from 'react';\nimport { bind, clear } from 'size-sensor';\nimport { pick } from './helper/pick';\nimport { isFunction } from './helper/is-function';\nimport { isString } from './helper/is-string';\nimport { isEqual } from './helper/is-equal';\n/**\n * core component for echarts binding\n */\n\nvar EChartsReactCore = function (_super) {\n  __extends(EChartsReactCore, _super);\n\n  function EChartsReactCore(props) {\n    var _this = _super.call(this, props) || this;\n\n    _this.echarts = props.echarts;\n    _this.ele = null;\n    return _this;\n  }\n\n  EChartsReactCore.prototype.componentDidMount = function () {\n    this.renderNewEcharts();\n  }; // update\n\n\n  EChartsReactCore.prototype.componentDidUpdate = function (prevProps) {\n    /**\n     * if shouldSetOption return false, then return, not update echarts options\n     * default is true\n     */\n    var shouldSetOption = this.props.shouldSetOption;\n\n    if (isFunction(shouldSetOption) && !shouldSetOption(prevProps, this.props)) {\n      return;\n    } // 以下属性修改的时候，需要 dispose 之后再新建\n    // 1. 切换 theme 的时候\n    // 2. 修改 opts 的时候\n    // 3. 修改 onEvents 的时候，这样可以取消所有之前绑定的事件 issue #151\n\n\n    if (!isEqual(prevProps.theme, this.props.theme) || !isEqual(prevProps.opts, this.props.opts) || !isEqual(prevProps.onEvents, this.props.onEvents)) {\n      this.dispose();\n      this.renderNewEcharts(); // 重建\n\n      return;\n    } // when thoes props isEqual, do not update echarts\n\n\n    var pickKeys = ['option', 'notMerge', 'lazyUpdate', 'showLoading', 'loadingOption'];\n\n    if (isEqual(pick(this.props, pickKeys), pick(prevProps, pickKeys))) {\n      return;\n    }\n\n    var echartsInstance = this.updateEChartsOption();\n    /**\n     * when style or class name updated, change size.\n     */\n\n    if (!isEqual(prevProps.style, this.props.style) || !isEqual(prevProps.className, this.props.className)) {\n      try {\n        echartsInstance.resize();\n      } catch (e) {\n        console.warn(e);\n      }\n    }\n  };\n\n  EChartsReactCore.prototype.componentWillUnmount = function () {\n    this.dispose();\n  };\n  /**\n   * return the echart object\n   * 1. if exist, return the existed instance\n   * 2. or new one instance\n   */\n\n\n  EChartsReactCore.prototype.getEchartsInstance = function () {\n    return this.echarts.getInstanceByDom(this.ele) || this.echarts.init(this.ele, this.props.theme, this.props.opts);\n  };\n  /**\n   * dispose echarts and clear size-sensor\n   */\n\n\n  EChartsReactCore.prototype.dispose = function () {\n    if (this.ele) {\n      try {\n        clear(this.ele);\n      } catch (e) {\n        console.warn(e);\n      } // dispose echarts instance\n\n\n      this.echarts.dispose(this.ele);\n    }\n  };\n  /**\n   * render a new echarts instance\n   */\n\n\n  EChartsReactCore.prototype.renderNewEcharts = function () {\n    var _a = this.props,\n        onEvents = _a.onEvents,\n        onChartReady = _a.onChartReady; // 1. new echarts instance\n\n    var echartsInstance = this.updateEChartsOption(); // 2. bind events\n\n    this.bindEvents(echartsInstance, onEvents || {}); // 3. on chart ready\n\n    if (isFunction(onChartReady)) onChartReady(echartsInstance); // 4. on resize\n\n    if (this.ele) {\n      bind(this.ele, function () {\n        try {\n          echartsInstance.resize();\n        } catch (e) {\n          console.warn(e);\n        }\n      });\n    }\n  }; // bind the events\n\n\n  EChartsReactCore.prototype.bindEvents = function (instance, events) {\n    function _bindEvent(eventName, func) {\n      // ignore the event config which not satisfy\n      if (isString(eventName) && isFunction(func)) {\n        // binding event\n        instance.on(eventName, function (param) {\n          func(param, instance);\n        });\n      }\n    } // loop and bind\n\n\n    for (var eventName in events) {\n      if (Object.prototype.hasOwnProperty.call(events, eventName)) {\n        _bindEvent(eventName, events[eventName]);\n      }\n    }\n  };\n  /**\n   * render the echarts\n   */\n\n\n  EChartsReactCore.prototype.updateEChartsOption = function () {\n    var _a = this.props,\n        option = _a.option,\n        _b = _a.notMerge,\n        notMerge = _b === void 0 ? false : _b,\n        _c = _a.lazyUpdate,\n        lazyUpdate = _c === void 0 ? false : _c,\n        showLoading = _a.showLoading,\n        _d = _a.loadingOption,\n        loadingOption = _d === void 0 ? null : _d; // 1. get or initial the echarts object\n\n    var echartInstance = this.getEchartsInstance(); // 2. set the echarts option\n\n    echartInstance.setOption(option, notMerge, lazyUpdate); // 3. set loading mask\n\n    if (showLoading) echartInstance.showLoading(loadingOption);else echartInstance.hideLoading();\n    return echartInstance;\n  };\n\n  EChartsReactCore.prototype.render = function () {\n    var _this = this;\n\n    var _a = this.props,\n        style = _a.style,\n        _b = _a.className,\n        className = _b === void 0 ? '' : _b; // default height = 300\n\n    var newStyle = __assign({\n      height: 300\n    }, style);\n\n    return React.createElement(\"div\", {\n      ref: function ref(e) {\n        _this.ele = e;\n      },\n      style: newStyle,\n      className: \"echarts-for-react \" + className\n    });\n  };\n\n  return EChartsReactCore;\n}(PureComponent);\n\nexport default EChartsReactCore;","map":{"version":3,"sources":["../src/core.tsx"],"names":[],"mappings":"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","sourcesContent":["import React, { PureComponent } from 'react';\nimport { bind, clear } from 'size-sensor';\nimport { pick } from './helper/pick';\nimport { isFunction } from './helper/is-function';\nimport { isString } from './helper/is-string';\nimport { isEqual } from './helper/is-equal';\nimport { EChartsReactProps, EChartsInstance } from './types';\n\n/**\n * core component for echarts binding\n */\nexport default class EChartsReactCore extends PureComponent<EChartsReactProps> {\n  /**\n   * echarts render container\n   */\n  public ele: HTMLElement;\n\n  /**\n   * echarts library entry\n   */\n  protected echarts: any;\n\n  constructor(props: EChartsReactProps) {\n    super(props);\n\n    this.echarts = props.echarts;\n    this.ele = null;\n  }\n\n  componentDidMount() {\n    this.renderNewEcharts();\n  }\n\n  // update\n  componentDidUpdate(prevProps: EChartsReactProps) {\n    /**\n     * if shouldSetOption return false, then return, not update echarts options\n     * default is true\n     */\n    const { shouldSetOption } = this.props;\n    if (isFunction(shouldSetOption) && !shouldSetOption(prevProps, this.props)) {\n      return;\n    }\n\n    // 以下属性修改的时候，需要 dispose 之后再新建\n    // 1. 切换 theme 的时候\n    // 2. 修改 opts 的时候\n    // 3. 修改 onEvents 的时候，这样可以取消所有之前绑定的事件 issue #151\n    if (\n      !isEqual(prevProps.theme, this.props.theme) ||\n      !isEqual(prevProps.opts, this.props.opts) ||\n      !isEqual(prevProps.onEvents, this.props.onEvents)\n    ) {\n      this.dispose();\n\n      this.renderNewEcharts(); // 重建\n      return;\n    }\n\n    // when thoes props isEqual, do not update echarts\n    const pickKeys = ['option', 'notMerge', 'lazyUpdate', 'showLoading', 'loadingOption'];\n    if (isEqual(pick(this.props, pickKeys), pick(prevProps, pickKeys))) {\n      return;\n    }\n\n    const echartsInstance = this.updateEChartsOption();\n    /**\n     * when style or class name updated, change size.\n     */\n    if (!isEqual(prevProps.style, this.props.style) || !isEqual(prevProps.className, this.props.className)) {\n      try {\n        echartsInstance.resize();\n      } catch (e) {\n        console.warn(e);\n      }\n    }\n  }\n\n  componentWillUnmount() {\n    this.dispose();\n  }\n\n  /**\n   * return the echart object\n   * 1. if exist, return the existed instance\n   * 2. or new one instance\n   */\n  public getEchartsInstance() {\n    return this.echarts.getInstanceByDom(this.ele) || this.echarts.init(this.ele, this.props.theme, this.props.opts);\n  }\n\n  /**\n   * dispose echarts and clear size-sensor\n   */\n  private dispose() {\n    if (this.ele) {\n      try {\n        clear(this.ele);\n      } catch (e) {\n        console.warn(e);\n      }\n      // dispose echarts instance\n      this.echarts.dispose(this.ele);\n    }\n  }\n\n  /**\n   * render a new echarts instance\n   */\n  private renderNewEcharts() {\n    const { onEvents, onChartReady } = this.props;\n\n    // 1. new echarts instance\n    const echartsInstance = this.updateEChartsOption();\n\n    // 2. bind events\n    this.bindEvents(echartsInstance, onEvents || {});\n\n    // 3. on chart ready\n    if (isFunction(onChartReady)) onChartReady(echartsInstance);\n\n    // 4. on resize\n    if (this.ele) {\n      bind(this.ele, () => {\n        try {\n          echartsInstance.resize();\n        } catch (e) {\n          console.warn(e);\n        }\n      });\n    }\n  }\n\n  // bind the events\n  private bindEvents(instance, events: EChartsReactProps['onEvents']) {\n    function _bindEvent(eventName: string, func: Function) {\n      // ignore the event config which not satisfy\n      if (isString(eventName) && isFunction(func)) {\n        // binding event\n        instance.on(eventName, (param) => {\n          func(param, instance);\n        });\n      }\n    }\n\n    // loop and bind\n    for (const eventName in events) {\n      if (Object.prototype.hasOwnProperty.call(events, eventName)) {\n        _bindEvent(eventName, events[eventName]);\n      }\n    }\n  }\n\n  /**\n   * render the echarts\n   */\n  private updateEChartsOption(): EChartsInstance {\n    const { option, notMerge = false, lazyUpdate = false, showLoading, loadingOption = null } = this.props;\n    // 1. get or initial the echarts object\n    const echartInstance = this.getEchartsInstance();\n    // 2. set the echarts option\n    echartInstance.setOption(option, notMerge, lazyUpdate);\n    // 3. set loading mask\n    if (showLoading) echartInstance.showLoading(loadingOption);\n    else echartInstance.hideLoading();\n\n    return echartInstance;\n  }\n\n  render(): JSX.Element {\n    const { style, className = '' } = this.props;\n    // default height = 300\n    const newStyle = { height: 300, ...style };\n\n    return (\n      <div\n        ref={(e: HTMLElement) => {\n          this.ele = e;\n        }}\n        style={newStyle}\n        className={`echarts-for-react ${className}`}\n      />\n    );\n  }\n}\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}